# Progress Log

## Current Status
- **Phase 1:** CMS Foundation (US-001 to US-012) - COMPLETE (12/12 complete)
- **Phase 2:** Inner Pages (US-013 to US-025) - COMPLETE (13/13 complete)
- **Phase 3:** Interactive Features (US-026 to US-036) - COMPLETE (11/11 complete)
- **Phase 4:** Polish & SEO (US-037 to US-042) - NOT STARTED
- **Phase 5:** Contact & Maps Integration (US-043 to US-048) - NOT STARTED

## Completed Stories
- US-001: Initialize Sanity Studio project
- US-002: Create localizedString and localizedText object schemas
- US-003: Create SEO and portableText object schemas
- US-004: Create Service document schema
- US-005: Create TeamMember document schema
- US-006: Create Testimonial document schema
- US-007: Create BeforeAfter document schema
- US-008: Create BlogPost and BlogCategory schemas
- US-009: Create FAQ and Price document schemas
- US-010: Create Settings singleton and LegalPage schemas
- US-011: Create GROQ queries for all content types
- US-012: Create Sanity image URL helper
- US-013: Create service page template with Sanity integration
- US-014: Create services listing page
- US-015: Create team listing page
- US-016: Create individual team member page
- US-017: Create testimonials page
- US-018: Create FAQ page with accordion
- US-019: Create prices page with basic listing
- US-020: Create contact page with info and map
- US-021: Create contact form component
- US-022: Create contact form API route
- US-023: Create blog listing page
- US-024: Create individual blog post page
- US-025: Create legal pages template
- US-026: Create Before/After gallery page with filter
- US-027: Create Before/After comparison slider component
- US-028: Create gallery modal with case details
- US-029: Create price calculator - step 1 (service selection)
- US-030: Create price calculator - step 2 (options and quantity)
- US-031: Create price calculator - results display
- US-032: Integrate calculator into prices page
- US-033: Create cookie consent banner
- US-034: Create cookie preferences modal
- US-035: Create WhatsApp floating button
- US-036: Create video testimonial player component

## In Progress
(None)

## Learnings
(Patterns discovered during implementation)
- Use bracket notation for process.env access: `process.env['VARIABLE']` instead of `process.env.VARIABLE` to satisfy exactOptionalPropertyTypes
- next-sanity@11 is compatible with Next.js 15, sanity@4, and @sanity/client@7
- Sanity Studio route needs its own layout.tsx to avoid locale routing conflicts
- Use `as const` for href arrays to satisfy next-intl typed routes

---

## Session Notes

### 2026-01-15
- PRD created with 42 user stories
- Stories organized in 4 phases by dependency
- Each story sized for single context window (~10 min AI work)
- Foundation already complete: Next.js 15, Tailwind v4, next-intl, Header/Footer/Homepage with placeholder

---

## Iteration 1 - US-001: Initialize Sanity Studio project
- What was implemented:
  - Installed Sanity dependencies (next-sanity@11, sanity@4, @sanity/client@7, @sanity/image-url, styled-components@6)
  - Created sanity.config.ts at project root
  - Created src/lib/sanity/client.ts with createClient setup and preview client
  - Created sanity/schemas/index.ts (empty, ready for future schemas)
  - Created Sanity Studio route at /studio with dedicated layout
  - Updated .env.example with SANITY_* environment variables
- Files changed:
  - package.json (added dependencies)
  - sanity.config.ts (new)
  - sanity/schemas/index.ts (new)
  - src/lib/sanity/client.ts (new)
  - src/app/studio/[[...tool]]/page.tsx (new)
  - src/app/studio/[[...tool]]/layout.tsx (new)
  - .env.example (updated)
- Pre-existing type errors fixed:
  - src/app/[locale]/layout.tsx - fixed metadata title/description typing
  - src/components/layout/Footer.tsx - fixed Link href typing with `as const`
- Learnings for future iterations:
  - next-sanity@12+ requires Next.js 16, use @11 for Next.js 15
  - TypeScript exactOptionalPropertyTypes requires explicit string defaults
  - Studio route bypasses locale routing via separate app directory structure
---

## Iteration 2 - US-002: Create localizedString and localizedText object schemas
- What was implemented:
  - Created `sanity/schemas/objects/localizedString.ts` with ro, en, hu string fields
  - Created `sanity/schemas/objects/localizedText.ts` with ro, en, hu text fields
  - Updated `sanity/schemas/index.ts` to export both schema types
- Files changed:
  - sanity/schemas/objects/localizedString.ts (new)
  - sanity/schemas/objects/localizedText.ts (new)
  - sanity/schemas/index.ts (updated)
- Learnings for future iterations:
  - Sanity uses defineType and defineField from 'sanity' package for schema definitions
  - Object schemas go in sanity/schemas/objects/ directory
  - All schemas must be exported from schemaTypes array in index.ts
---

## Iteration 3 - US-003: Create SEO and portableText object schemas
- What was implemented:
  - Created `sanity/schemas/objects/seo.ts` with metaTitle, metaDescription, ogImage, noIndex fields
  - Created `sanity/schemas/objects/portableText.ts` with blocks (h2-h4, blockquote), lists, marks (strong/em/underline), link annotations, images with alt/caption, and video embed support
  - Created `sanity/schemas/objects/localizedPortableText.ts` wrapping portableText for RO/EN/HU
  - Updated `sanity/schemas/index.ts` to export all new schemas
- Files changed:
  - sanity/schemas/objects/seo.ts (new)
  - sanity/schemas/objects/portableText.ts (new)
  - sanity/schemas/objects/localizedPortableText.ts (new)
  - sanity/schemas/index.ts (updated)
- Learnings for future iterations:
  - Use defineArrayMember for array items in Sanity schemas
  - portableText is defined as type 'array' not 'object', containing block and other content types
  - Video embed uses inline object type with name for custom block types
---

## Iteration 4 - US-004: Create Service document schema
- What was implemented:
  - Created `sanity/schemas/documents/service.ts` with all required fields: title (localizedString), slug, icon, shortDescription, description (localizedPortableText), benefits (array of objects), process (array of steps), heroImage, priceRange, seo, order
  - Added validation for required fields (title, slug)
  - Exported service schema from `sanity/schemas/index.ts`
  - Organized index.ts with comments separating Objects and Documents
- Files changed:
  - sanity/schemas/documents/service.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Document schemas go in sanity/schemas/documents/ directory (separate from objects/)
  - Use `defineArrayMember` for inline object types in arrays
  - Preview prepare function allows custom formatting in Sanity Studio list views
  - Orderings allow custom sort options in Studio document lists
---

## Iteration 5 - US-005: Create TeamMember document schema
- What was implemented:
  - Created `sanity/schemas/documents/teamMember.ts` with all required fields
  - Fields: name (string), slug, role (localizedString), specializations (array of objects), photo (image with hotspot), bio (localizedPortableText), education (array with institution/degree/year), certifications (array with name/issuer/year), services (references to service), order, seo
  - Added validation for required fields (name, slug)
  - Exported teamMember schema from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/teamMember.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Reference fields use `defineArrayMember({ type: 'reference', to: [{ type: 'docType' }] })`
  - Array of objects with preview prepare allows custom formatting with multiple select fields
  - Name field uses plain string type (not localizedString) for proper person names
---

## Iteration 6 - US-006: Create Testimonial document schema
- What was implemented:
  - Created `sanity/schemas/documents/testimonial.ts` with all required fields
  - Fields: patientName (string), patientPhoto (image with hotspot), rating (number 1-5), text (localizedText), videoUrl (url), videoFile (file), service (reference), doctor (reference), featured (boolean), date
  - Added validation: rating min 1 max 5 with integer constraint
  - Exported testimonial schema from `sanity/schemas/index.ts`
  - Custom preview with star rating display (★☆) and service name
- Files changed:
  - sanity/schemas/documents/testimonial.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Single reference fields use `type: 'reference', to: [{ type: 'docType' }]` without array wrapper
  - File fields support accept option for MIME type filtering (e.g., 'video/*')
  - Unicode characters (★☆) work in preview prepare for visual star ratings
---

## Iteration 7 - US-007: Create BeforeAfter document schema
- What was implemented:
  - Created `sanity/schemas/documents/beforeAfter.ts` with all required fields
  - Fields: title (localizedString), service (reference), doctor (reference), beforeImage (required image with hotspot), afterImage (required image with hotspot), description (localizedText), treatmentDuration (string), featured (boolean)
  - Added validation: both beforeImage and afterImage are required
  - Custom preview showing title, service name, featured status, and after image
  - Custom orderings: Featured First, Newest First
  - Exported beforeAfter schema from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/beforeAfter.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - BeforeAfter cases use localizedText for description (not localizedPortableText) since rich text isn't needed for brief case descriptions
  - Image fields with required validation use `validation: (rule) => rule.required()`
  - Preview uses afterImage as media to show the successful result
---

## Iteration 8 - US-008: Create BlogPost and BlogCategory schemas
- What was implemented:
  - Created `sanity/schemas/documents/blogCategory.ts` with title (localizedString) and slug fields
  - Created `sanity/schemas/documents/blogPost.ts` with all required fields: title, slug, excerpt, content (localizedPortableText), coverImage, category (reference to blogCategory), author (reference to teamMember), publishedAt, featured, seo
  - Added validation for required fields (title, slug) on both schemas
  - Custom preview for blogPost showing title, category, author, and published date
  - Custom orderings for blogPost: newest first, oldest first, title
  - Exported both schemas from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/blogCategory.ts (new)
  - sanity/schemas/documents/blogPost.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - BlogCategory is a simple schema - just title and slug, no complex fields needed
  - BlogPost references both blogCategory and teamMember for category and author
  - Preview prepare can format dates using toLocaleDateString for locale-specific display
  - Draft posts without publishedAt can show 'Draft' as fallback in preview
---

## Iteration 9 - US-009: Create FAQ and Price document schemas
- What was implemented:
  - Created `sanity/schemas/documents/faq.ts` with all required fields
  - Fields: question (localizedString), answer (localizedPortableText), category (select with radio layout), services (references array), order
  - Created `sanity/schemas/documents/price.ts` with all required fields
  - Fields: service (reference), name (localizedString), description (localizedText), priceMin, priceMax, unit, isPromotion, promotionPrice (conditionally hidden), includesInCalculator
  - Added validation for required fields
  - Exported both schemas from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/faq.ts (new)
  - sanity/schemas/documents/price.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Use `options.layout: 'radio'` for select fields with few options
  - `hidden: ({ parent }) => !parent?.field` allows conditional field visibility in Sanity
  - Price documents reference services to enable grouping prices by service category
  - Category-based FAQs use string select with defined list for filtering/grouping
---

## Iteration 10 - US-010: Create Settings singleton and LegalPage schemas
- What was implemented:
  - Created `sanity/schemas/documents/settings.ts` singleton schema with:
    - siteName (localizedString), logo (image), contact object (phone, email, whatsapp, address)
    - workingHours (array with days, hours, closed fields)
    - socialLinks (object with facebook, instagram, youtube, linkedin, tiktok URLs)
    - googleMapsEmbed (url)
  - Created `sanity/schemas/documents/legalPage.ts` schema with:
    - title (localizedString), slug, content (localizedPortableText), lastUpdated (date)
  - Created `sanity/deskStructure.ts` for custom Sanity Studio desk structure
    - Settings displayed as singleton (single document with fixed ID 'siteSettings')
    - Organized content into logical groups with icons
    - Blog section nested with Posts and Categories
  - Updated `sanity.config.ts` to use custom desk structure
  - Exported both schemas from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/settings.ts (new)
  - sanity/schemas/documents/legalPage.ts (new)
  - sanity/deskStructure.ts (new)
  - sanity.config.ts (updated)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Singleton documents use fixed documentId in desk structure: `S.document().schemaType('settings').documentId('siteSettings')`
  - structureTool() accepts structure option for custom desk organization
  - Lucide icons need type casting: `const icon = (Icon: ComponentType) => Icon as ComponentType`
  - URL fields use `type: 'url'` for proper validation
  - Date fields can specify format with `options.dateFormat`
---

## Iteration 11 - US-011: Create GROQ queries for all content types
- What was implemented:
  - Created `src/lib/sanity/queries.ts` with comprehensive GROQ queries for all content types
  - Query functions: getAllServices, getServiceBySlug, getServiceSlugs, getAllTeamMembers, getTeamMemberBySlug, getTeamMemberSlugs, getAllTestimonials, getFeaturedTestimonials, getAllBeforeAfter, getFeaturedBeforeAfter, getBlogPosts, getBlogPostBySlug, getBlogPostSlugs, getBlogCategories, getBlogPostsCount, getFAQs, getFAQsByCategory, getPrices, getPricesGroupedByService, getSettings, getLegalPageBySlug, getLegalPageSlugs
  - All queries accept locale parameter (ro/en/hu) for localized content projection
  - Helper functions for consistent localized field projections
  - Queries include proper dereferencing with `->` for referenced documents
  - Support for pagination (getBlogPosts with limit/offset) and filtering (category, featured, etc.)
- Files changed:
  - src/lib/sanity/queries.ts (new)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - Use helper functions for repeated localized field projections to keep queries DRY
  - GROQ uses `->` for dereferencing references inline
  - Portable text arrays need `[]` suffix in projection: `fieldName.${locale}[]`
  - String interpolation with template literals works well for dynamic GROQ query building
  - Sanity client.fetch accepts params object as second argument for query variables
---

## Iteration 12 - US-012: Create Sanity image URL helper
- What was implemented:
  - Created `src/lib/sanity/image.ts` with comprehensive image URL utilities
  - Main helper `urlFor(source)` returns ImageUrlBuilder for chaining transformations (width, height, quality, auto format, blur, etc.)
  - Added `generateSrcSet()` helper for responsive image srcset generation
  - Added `getBlurDataURL()` helper for blur placeholders
  - Package @sanity/image-url was already installed in US-001
- Files changed:
  - src/lib/sanity/image.ts (new)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - @sanity/image-url v2 exports SanityImageSource type directly from main module
  - ImageUrlBuilder supports chaining: urlFor(image).width(800).quality(80).auto('format').url()
  - Phase 1 (CMS Foundation) is now complete - all schemas and helpers are ready
---

## Iteration 13 - US-013: Create service page template with Sanity integration
- What was implemented:
  - Created `/src/app/[locale]/servicii/[slug]/page.tsx` with full Sanity integration
  - Hero section with service icon, title, description, price range, and hero image using next/image
  - Description section rendering portable text content
  - Benefits section displaying array of benefit items with icons
  - Process timeline showing treatment steps with numbered timeline UI
  - FAQ accordion using native `<details>` element for service-related FAQs
  - CTA section with call-to-action buttons
  - `generateStaticParams` for static generation of all services in all locales
  - `generateMetadata` for SEO with title, description, and open graph images
  - Dynamic Lucide icon loading based on service.icon field from Sanity
  - Simple PortableText renderer for description content
- Files changed:
  - src/app/[locale]/servicii/[slug]/page.tsx (new)
  - src/types/global.d.ts (fixed ESLint error)
  - .env.local (created from .env.example for build)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - ESLint import/order rule is strict: type imports from external packages go first, then type imports from framework, then regular imports
  - Props must be sorted: shorthand props (fill, priority) first, then alphabetically
  - Reserved props (key) must be listed first before other props
  - Use bracket notation for index signature access: `block['children']` not `block.children`
  - PortableText rendering can use simple approach with array filtering for basic use cases
  - Dynamic Lucide icons can be loaded with `import * as LucideIcons from 'lucide-react'` and accessed by name
---

## Iteration 14 - US-014: Create services listing page
- What was implemented:
  - Updated `/src/app/[locale]/servicii/page.tsx` to fetch services from Sanity
  - Hero section with page title and subtitle from translations
  - Grid of service cards (3 columns desktop, 2 tablet, 1 mobile)
  - Each card displays: dynamic Lucide icon, title, short description, "Learn more" link
  - Links use typed routing: `{ pathname: '/servicii/[slug]', params: { slug: service.slug } }`
  - Placeholder component shows when Sanity has no services (graceful fallback)
  - CTA section with appointment button and phone number
  - generateMetadata for SEO
- Files changed:
  - src/app/[locale]/servicii/page.tsx (updated)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - For dynamic routes with next-intl typed routing, use object format: `href={{ pathname: '/servicii/[slug]', params: { slug: value } }}`
  - String template literals like `/servicii/${slug}` don't work with typed routes - must use object format
  - getAllServices returns services ordered by `order` field (implemented in GROQ query)
---

## Iteration 15 - US-015: Create team listing page
- What was implemented:
  - Updated `/src/app/[locale]/echipa/page.tsx` with Sanity integration
  - Hero section with page title and subtitle from translations
  - Grid of team member cards (3 columns desktop, 2 tablet, 1 mobile)
  - Each card displays: photo (or User icon placeholder), name, role, specialization tags, "Learn more" link
  - Photos use next/image with urlFor helper for optimized Sanity images
  - Links use typed routing: `{ pathname: '/echipa/[slug]', params: { slug: member.slug } }`
  - Placeholder component shows when Sanity has no team members (graceful fallback)
  - CTA section with appointment button and phone number
  - generateMetadata for SEO
- Files changed:
  - src/app/[locale]/echipa/page.tsx (updated)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - Team member photos use aspect-[4/5] for portrait orientation
  - Specializations limited to 3 visible tags with "+N" overflow indicator
  - Same pattern as services page: fetch from Sanity, fallback to placeholder if empty
  - Image component with fill prop requires parent with position: relative and defined dimensions
---

## Iteration 16 - US-016: Create individual team member page
- What was implemented:
  - Created `/src/app/[locale]/echipa/[slug]/page.tsx` with full Sanity integration
  - Hero section with photo (or User icon placeholder), name, role, and specialization tags
  - Bio section rendering portable text content with BookOpen icon
  - Education section showing degree, institution, and year in card layout
  - Certifications section with 2-column grid layout
  - Services offered section with links to individual service pages (typed routing)
  - CTA section with appointment booking and "View all team" button
  - `generateStaticParams` for static generation of all team members in all locales
  - `generateMetadata` for SEO with title, description, and open graph images
  - Added translation keys for team member page: about, education, certifications, servicesOffered, viewAll
- Files changed:
  - src/app/[locale]/echipa/[slug]/page.tsx (new)
  - src/messages/ro.json (updated - added team section translations)
  - src/messages/en.json (updated - added team section translations)
  - src/messages/hu.json (updated - added team section translations)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - Team member page follows same pattern as service page: fetch by slug, notFound() if not found
  - PortableTextRenderer component can be reused between pages (consider extracting to shared component later)
  - Typed routing for service links uses object format: `{ pathname: '/servicii/[slug]', params: { slug } }`
  - 404 page is automatically shown when notFound() is called - works correctly
---

## Iteration 17 - US-017: Create testimonials page
- What was implemented:
  - Created `/src/app/[locale]/testimoniale/page.tsx` with full Sanity integration
  - Testimonial cards display: patient name, rating stars (1-5), text, treatment type
  - Video testimonials have play button overlay (supports YouTube/Vimeo/direct video files)
  - Filter by treatment type via URL params (`?service=slug`)
  - Updated `getAllTestimonials` query to accept optional serviceSlug filter
  - Added translation keys for testimonials page in all 3 locales (RO/EN/HU)
  - Placeholder testimonials shown when Sanity has no data
- Files changed:
  - src/app/[locale]/testimoniale/page.tsx (new)
  - src/lib/sanity/queries.ts (updated - added service filter to getAllTestimonials)
  - src/messages/ro.json (updated - added testimonials page translations)
  - src/messages/en.json (updated - added testimonials page translations)
  - src/messages/hu.json (updated - added testimonials page translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - ESLint import order: lucide-react imports should come before type imports from next
  - ESLint jsx-sort-props: shorthand props (fill, priority) must be listed before other props
  - URL params with typed routing: use string literal with type cast `'/testimoniale?service=slug' as '/testimoniale'`
  - searchParams in Next.js 15 must be awaited: `const resolvedSearchParams = await searchParams`
  - Testimonials page pattern: fetch all testimonials + all services (for filter buttons)
---

## Iteration 18 - US-018: Create FAQ page with accordion
- What was implemented:
  - Created `/src/app/[locale]/faq/page.tsx` with full Sanity integration
  - Created `src/app/[locale]/faq/FAQPageClient.tsx` for interactive category tabs
  - Created `src/components/ui/Accordion.tsx` reusable component with smooth animations
  - Accordion supports single or multiple open items via `allowMultiple` prop
  - FAQ page displays category tabs (General, Pricing, Treatments, Appointments)
  - Uses `getFAQsByCategory` GROQ query to fetch FAQs grouped by category
  - Placeholder FAQs shown when Sanity has no data
  - Added translation keys for FAQ page in all 3 locales (RO/EN/HU)
- Files changed:
  - src/app/[locale]/faq/page.tsx (new)
  - src/app/[locale]/faq/FAQPageClient.tsx (new)
  - src/components/ui/Accordion.tsx (new)
  - src/messages/ro.json (updated - added faq section translations)
  - src/messages/en.json (updated - added faq section translations)
  - src/messages/hu.json (updated - added faq section translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - Client components needed for interactive tabs/accordion state management
  - Accordion uses CSS max-h transition with overflow-hidden for smooth animations
  - Category tabs pattern: filter displayed content based on active category state
  - Placeholder content follows same pattern as previous pages (translations for placeholder text)
  - Portable text rendering can be simple (just text extraction) for basic content like FAQ answers
---

## Iteration 19 - US-019: Create prices page with basic listing
- What was implemented:
  - Created `/src/app/[locale]/preturi/page.tsx` with full Sanity integration
  - Price tables organized by service category using `getPricesGroupedByService` query
  - Each service displayed as a card with icon, title, and price list
  - Shows price range (min-max) with unit when applicable
  - Promotional prices highlighted with badge and strikethrough original price
  - Disclaimer about prices being estimates displayed below hero
  - Placeholder prices shown when Sanity has no data
  - Added translation keys for prices page in all 3 locales (RO/EN/HU)
- Files changed:
  - src/app/[locale]/preturi/page.tsx (new)
  - src/messages/ro.json (updated - added prices section translations)
  - src/messages/en.json (updated - added prices section translations)
  - src/messages/hu.json (updated - added prices section translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - LucideIcons type casting must use `Record<string, LucideIcon | unknown>` pattern to satisfy TypeScript
  - Price formatting with Intl.NumberFormat('ro-RO') for Romanian number format
  - Promotional prices use green styling (bg-green-50, text-green-600) for visual distinction
  - Prices grouped by service using GROQ query with references() function
---

## Iteration 20 - US-020: Create contact page with info and map
- What was implemented:
  - Updated `/src/app/[locale]/contact/page.tsx` with full Sanity integration
  - Contact info cards displaying: phone (click-to-call), WhatsApp quick contact, email, address
  - Working hours display with closed day indication
  - Embedded Google Maps iframe from Sanity settings (with fallback)
  - Social links section (Facebook, Instagram, YouTube, LinkedIn)
  - Quick contact CTA card with phone button
  - Get directions link to Google Maps
  - `getSettings` query fetches contact info from Sanity settings singleton
  - Added translation keys for contact page in all 3 locales (RO/EN/HU)
- Files changed:
  - src/app/[locale]/contact/page.tsx (updated)
  - src/messages/ro.json (updated - added contact section translations)
  - src/messages/en.json (updated - added contact section translations)
  - src/messages/hu.json (updated - added contact section translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - Contact page uses settings singleton document for phone, email, address, working hours
  - WhatsApp links use wa.me API with pre-filled message: `https://wa.me/40${phone}?text=${encodeURIComponent(message)}`
  - Google Maps embed uses iframe with src from Sanity googleMapsEmbed field
  - Working hours array supports closed days with boolean flag
  - Social links conditionally render only when URLs are provided in settings
---

## Iteration 21 - US-021: Create contact form component
- What was implemented:
  - Created `src/components/features/ContactForm/index.tsx` client component
  - Form fields: name (required), email (required), phone (optional), subject dropdown (required), message (required), GDPR checkbox (required)
  - Client-side validation with error messages displayed under each field
  - Loading state with spinner icon during form submission
  - Success/error message display after submission
  - Form resets on successful submission
  - Integrated ContactForm into contact page below the map section
  - Added translation keys for contactForm in all 3 locales (RO/EN/HU)
- Files changed:
  - src/components/features/ContactForm/index.tsx (new)
  - src/app/[locale]/contact/page.tsx (updated - added ContactForm import and integration)
  - src/messages/ro.json (updated - added contactForm translations)
  - src/messages/en.json (updated - added contactForm translations)
  - src/messages/hu.json (updated - added contactForm translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - Client components with 'use client' directive for form interactivity
  - useCallback for memoizing form handlers to prevent unnecessary re-renders
  - Email regex validation: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`
  - Phone regex validation: `/^[0-9+\s()-]{6,20}$/` for flexible international formats
  - GDPR consent checkbox is required for compliance
  - Form submits to /api/contact route (to be implemented in US-022)
---

## Iteration 22 - US-022: Create contact form API route
- What was implemented:
  - Created `/src/app/api/contact/route.ts` with POST handler
  - Server-side validation for all required fields (name, email, subject, message, gdprConsent)
  - Resend integration for sending email notifications
  - HTML email template with styled table layout
  - Rate limiting: max 5 requests per minute per IP (in-memory store)
  - HTML escaping to prevent XSS in email content
  - Graceful fallback when RESEND_API_KEY is not configured
  - Updated .env.example with RESEND_API_KEY and CONTACT_EMAIL variables
- Files changed:
  - src/app/api/contact/route.ts (new)
  - .env.example (updated)
  - package.json (added resend dependency)
  - PRD.md (updated)
- Learnings for future iterations:
  - exactOptionalPropertyTypes requires careful handling: don't assign undefined to optional props, conditionally add them
  - In-memory rate limiting works for single-server deployments; use Redis for production clusters
  - Resend package provides simple email sending: `resend.emails.send({ to, from, subject, html })`
  - HTML escaping is critical for user-submitted content in emails
  - Test validation by submitting invalid data and checking error responses
---

## Iteration 23 - US-023: Create blog listing page
- What was implemented:
  - Created `/src/app/[locale]/blog/page.tsx` with full Sanity integration
  - Blog cards showing: cover image, category badge, title, excerpt, date, reading time estimate, author
  - Category filter via URL params (`?category=slug`)
  - Pagination with 10 posts per page (`?page=N`)
  - Empty state when no posts found
  - CTA section at the bottom
  - Added blog translations to all 3 locales (RO/EN/HU)
- Files changed:
  - src/app/[locale]/blog/page.tsx (new)
  - src/messages/ro.json (updated - added blog translations)
  - src/messages/en.json (updated - added blog translations)
  - src/messages/hu.json (updated - added blog translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - exactOptionalPropertyTypes: build options objects conditionally instead of assigning undefined
  - Reading time can be estimated from excerpt length (multiply by factor since excerpt is a preview)
  - Category filter links use type cast: `'/blog?category=${slug}' as '/blog'`
  - Pagination shows previous/next arrows plus numbered pages
  - Empty state provides clear feedback and return link when filtered
---

## Iteration 24 - US-024: Create individual blog post page
- What was implemented:
  - Created `/src/app/[locale]/blog/[slug]/page.tsx` with full Sanity integration
  - Hero section with category badge, title, author, date, and reading time
  - Full-width cover image with rounded corners and shadow
  - Excerpt styled as intro paragraph
  - PortableText content rendering with proper styling
  - Share button with Web Share API support
  - Author bio card at bottom of article
  - Related posts section showing 2 posts from same category
  - Created `src/components/ui/PortableTextRenderer.tsx` component:
    - Supports headings (h2-h4), paragraphs, blockquotes
    - Supports lists (bullet and numbered)
    - Inline marks: strong, em, underline, code, links
    - Image blocks with captions
    - Video embeds (YouTube, Vimeo)
  - generateStaticParams for all blog posts in all locales
  - generateMetadata with SEO data from post
- Files changed:
  - src/app/[locale]/blog/[slug]/page.tsx (new)
  - src/components/ui/PortableTextRenderer.tsx (new)
  - PRD.md (updated)
- Learnings for future iterations:
  - PortableText renderer handles nested marks by processing in reverse order
  - Use `any[]` type for PortableText value to handle various Sanity content structures
  - Video embeds need URL parsing to extract video IDs for YouTube/Vimeo
  - List items must be grouped before rendering to create proper ul/ol elements
  - Reading time calculated from word count (200 words/minute)
---

## Iteration 25 - US-025: Create legal pages template
- What was implemented:
  - Created `/src/app/[locale]/[...slug]/page.tsx` catch-all route for legal pages
  - Supports slugs: politica-confidentialitate, politica-cookies, termeni-conditii (RO), and English variants
  - Hero section with FileText icon and page title
  - Last updated date displayed below title
  - PortableText content rendering in a card layout
  - Quick navigation links to other legal pages at bottom
  - Back to home button
  - Returns 404 for invalid slugs or missing content
  - generateStaticParams for all legal pages in all locales
- Files changed:
  - src/app/[locale]/[...slug]/page.tsx (new)
  - PRD.md (updated)
- Learnings for future iterations:
  - Catch-all routes use `[...slug]` and receive slug as array in params
  - Legal pages should validate against allowed slug list before querying Sanity
  - Phase 2 (Inner Pages) is now COMPLETE - all 13 stories finished
---

## Iteration 26 - US-026: Create Before/After gallery page with filter
- What was implemented:
  - Created `/src/app/[locale]/galerie/page.tsx` with full Sanity integration
  - Gallery cards showing split before/after image preview (side by side)
  - Filter buttons for treatment types via URL params (`?service=slug`)
  - Updated `getAllBeforeAfter` query to accept optional serviceSlug filter
  - Grid display with treatment type badge, title, description, duration, doctor
  - Featured badge for highlighted cases
  - Placeholder gallery cards when Sanity has no data
  - Added gallery translations to all 3 locales (RO/EN/HU)
- Files changed:
  - src/app/[locale]/galerie/page.tsx (new)
  - src/lib/sanity/queries.ts (updated - added service filter to getAllBeforeAfter)
  - src/messages/ro.json (updated - added gallery translations)
  - src/messages/en.json (updated - added gallery translations)
  - src/messages/hu.json (updated - added gallery translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - Gallery page follows same filter pattern as testimonials page
  - Split image preview uses two adjacent divs with w-1/2 each
  - URL params with typed routing: use string literal with type cast `'/galerie?service=slug' as '/galerie'`
  - Phase 3 (Interactive Features) begins - first story complete
---

## Iteration 27 - US-027: Create Before/After comparison slider component
- What was implemented:
  - Created `src/components/features/BeforeAfterGallery/ComparisonSlider.tsx` client component
  - Draggable divider using mouse events (mousedown, mousemove, mouseup)
  - Touch support for mobile (touchstart, touchmove, touchend)
  - Keyboard accessibility (ArrowLeft/ArrowRight to move, Home/End for extremes)
  - Labels for "Before" and "After" with customizable text via props
  - Smooth sliding using CSS clipPath for revealing before/after
  - Circular handle with left/right arrow icons
  - ARIA attributes: role="slider", aria-valuenow, aria-valuemin, aria-valuemax
  - Created `src/components/features/BeforeAfterGallery/index.ts` for exports
- Files changed:
  - src/components/features/BeforeAfterGallery/ComparisonSlider.tsx (new)
  - src/components/features/BeforeAfterGallery/index.ts (new)
  - PRD.md (updated)
- Learnings for future iterations:
  - Use clipPath CSS property for smooth image reveal: `clipPath: inset(0 ${100-pos}% 0 0)`
  - Global event listeners for mouse/touch tracking must be added to window during drag
  - Use passive: false for touchmove to prevent scrolling during drag
  - ARIA slider role requires aria-valuenow, aria-valuemin, aria-valuemax attributes
  - ESLint jsx-a11y enforces accessibility requirements strictly
---

## Iteration 28 - US-028: Create gallery modal with case details
- What was implemented:
  - Created `src/components/features/BeforeAfterGallery/GalleryModal.tsx` client component
  - Modal integrates ComparisonSlider for before/after image comparison
  - Shows case details: service badge, title, description, duration, doctor
  - Previous/Next navigation with wrap-around (last->first, first->last)
  - Keyboard navigation: Escape closes, ArrowLeft/ArrowRight navigates
  - Close on backdrop click
  - Pagination dots for quick navigation between cases
  - ARIA attributes for accessibility (role="dialog", aria-modal, aria-labelledby)
  - Body scroll prevention when modal is open
  - Created `src/app/[locale]/galerie/GalleryPageClient.tsx` client wrapper
  - Updated gallery page to use client components for modal state management
  - Gallery cards now clickable to open modal with hover overlay
  - Updated index.ts to export GalleryModal and GalleryCase type
- Files changed:
  - src/components/features/BeforeAfterGallery/GalleryModal.tsx (new)
  - src/components/features/BeforeAfterGallery/index.ts (updated)
  - src/app/[locale]/galerie/GalleryPageClient.tsx (new)
  - src/app/[locale]/galerie/page.tsx (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Client components needed for modal state management (open/close, current index)
  - Passing translations as props from server to client component keeps i18n working
  - Pre-generate image URLs on server side to pass serializable data to client
  - Body scroll prevention: set document.body.style.overflow = 'hidden' when modal opens
  - Wrap-around navigation: when at end, go to 0; when at start, go to length-1
---

## Iteration 29 - US-029: Create price calculator - step 1 (service selection)
- What was implemented:
  - Created `src/components/features/PriceCalculator/index.tsx` - main calculator component with step management
  - Created `src/components/features/PriceCalculator/ServiceSelect.tsx` - service selection step with card grid
  - Services displayed as selectable cards with dynamic Lucide icons
  - Single selection with visual highlight (border, background, checkmark)
  - "Next" button disabled until service selected, enabled when selected
  - Placeholder steps for options (US-030) and results (US-031)
  - Added priceCalculator translations to all 3 locales (RO/EN/HU)
- Files changed:
  - src/components/features/PriceCalculator/index.tsx (new)
  - src/components/features/PriceCalculator/ServiceSelect.tsx (new)
  - src/messages/ro.json (updated - added priceCalculator translations)
  - src/messages/en.json (updated - added priceCalculator translations)
  - src/messages/hu.json (updated - added priceCalculator translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - PriceCalculator uses multi-step wizard pattern with state machine for currentStep
  - Services passed as props from server component (for Sanity integration in US-032)
  - Translations passed as props to client component to maintain server/client separation
  - aria-pressed attribute used for toggle button accessibility
  - Selected state styling: border color + background + checkmark icon + icon background invert
---

## Iteration 30 - US-030: Create price calculator - step 2 (options and quantity)
- What was implemented:
  - Created `src/components/features/PriceCalculator/OptionsForm.tsx` client component
  - Quantity selector with +/- buttons (range: 1-32 units)
  - Material options (Standard/Premium) for applicable services (implants, crowns, veneers, prosthetics)
  - Dynamic service detection to show/hide material options based on service slug
  - Back button to return to service selection, Calculate button to proceed to results
  - Added new translations for options step in all 3 locales (RO/EN/HU)
  - Updated PriceCalculator index.tsx to manage options state and integrate OptionsForm
- Files changed:
  - src/components/features/PriceCalculator/OptionsForm.tsx (new)
  - src/components/features/PriceCalculator/index.tsx (updated)
  - src/messages/ro.json (updated - added options translations)
  - src/messages/en.json (updated - added options translations)
  - src/messages/hu.json (updated - added options translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - Material options only shown for specific service types (implants, crowns, veneers, prosthetics)
  - Quantity range limited to 1-32 (covers most dental scenarios)
  - Radio button-style selection uses aria-pressed and custom styling with radio circles
  - CalculatorOptions type exported from OptionsForm for use in parent and results components
  - canProceed validation: requires material selection only when materials are applicable
---

## Iteration 31 - US-031: Create price calculator - results display
- What was implemented:
  - Created `src/components/features/PriceCalculator/Results.tsx` client component
  - Shows price range (min-max RON) with locale-aware number formatting
  - Price calculation based on service type (using servicePriceRanges lookup table)
  - Premium material multiplier applied when premium option selected
  - Breakdown section showing: service name, quantity with unit, material type (if applicable)
  - Disclaimer in amber warning box about final price being determined after consultation
  - CTA button linking to contact page for scheduling free consultation
  - Back button to return to options step, Reset button to start over
  - Updated PriceCalculator/index.tsx to integrate Results component with reset handler
  - Added locale prop to PriceCalculator for proper number formatting
  - Added new translation keys for results step (estimatedPrice, priceRange, disclaimer, scheduleConsultation, reset)
- Files changed:
  - src/components/features/PriceCalculator/Results.tsx (new)
  - src/components/features/PriceCalculator/index.tsx (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Price estimation uses lookup table with partial slug matching for flexibility
  - Premium material multiplier is optional per service type (e.g., 1.5x for implants)
  - ESLint jsx-sort-props requires callbacks (onClick, onChange) to be listed AFTER all other props
  - ESLint import/order requires type imports and regular imports from same module together (no blank line)
  - Use defaultPriceRange constant instead of servicePriceRanges['default'] to avoid TypeScript undefined issues
---

## Iteration 32 - US-032: Integrate calculator into prices page
- What was implemented:
  - Integrated PriceCalculator component into `/src/app/[locale]/preturi/page.tsx`
  - Calculator positioned prominently above price lists with dedicated section
  - Fetches all services from Sanity via getAllServices query for calculator
  - Added "Calculeaza pretul tratamentului" CTA button in hero section
  - Smooth scroll to calculator section via anchor link (#calculator)
  - Added scroll-mt-20 class to calculator section for proper scroll offset
  - Calculator shows fallback message when no services available in Sanity
  - Both main content and placeholder pages have the calculator integrated
- Files changed:
  - src/app/[locale]/preturi/page.tsx (updated - added PriceCalculator integration)
  - src/messages/ro.json (updated - added prices.tryCalculator translation)
  - src/messages/en.json (updated - added prices.tryCalculator translation)
  - src/messages/hu.json (updated - added prices.tryCalculator translation)
  - PRD.md (updated)
- Learnings for future iterations:
  - Calculator translations must be gathered in server component and passed as props to client component
  - scroll-mt-20 class provides proper offset for sticky header when using anchor links
  - Server component can fetch multiple data sources in parallel with Promise.all
  - calculatorTranslations object pattern keeps translation keys organized for client components
---

## Iteration 33 - US-033: Create cookie consent banner
- What was implemented:
  - Created `src/components/features/CookieConsent/index.tsx` client component with:
    - Fixed bottom banner with cookie icon, title, description, link to cookie policy
    - "Accept All" primary button and "Only Essential" secondary button
    - Close button (X) that triggers essential-only consent
    - ARIA attributes for accessibility (role="dialog", aria-labelledby, aria-describedby)
  - Created `src/components/features/CookieConsent/CookieConsentWrapper.tsx` for i18n integration
  - Banner appears on first visit with 500ms delay to prevent flash
  - Stores consent value ('all', 'essential', 'custom') in localStorage
  - Stores detailed preferences (essential, analytics, marketing) in localStorage
  - Exports utility functions: getCookieConsent, getCookiePreferences, isAnalyticsEnabled, isMarketingEnabled
  - Integrated into layout.tsx after Footer component
  - Added cookieConsent translations to all 3 locales (RO/EN/HU)
- Files changed:
  - src/components/features/CookieConsent/index.tsx (new)
  - src/components/features/CookieConsent/CookieConsentWrapper.tsx (new)
  - src/app/[locale]/layout.tsx (updated - added CookieConsentWrapper)
  - src/messages/ro.json (updated - added cookieConsent translations)
  - src/messages/en.json (updated - added cookieConsent translations)
  - src/messages/hu.json (updated - added cookieConsent translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - Use wrapper component pattern for client components that need translations from useTranslations
  - localStorage check with delay prevents hydration mismatch and banner flash
  - isMounted state pattern ensures client-only rendering for localStorage access
  - CookiePreferences type can be extended in US-034 for customize modal
  - GDPR requires clear consent options - "Accept All" and "Essential Only" are minimum requirements
---

## Iteration 34 - US-034: Create cookie preferences modal
- What was implemented:
  - Added preferences modal to CookieConsent component
  - Three cookie categories: Essential (locked on), Analytics, Marketing
  - Toggle switches for Analytics and Marketing with role="switch" accessibility
  - Category descriptions explaining purpose of each cookie type
  - "Save Preferences" button saves custom preferences to localStorage
  - Modal closes on backdrop click or Escape key
  - Body scroll prevention when modal is open
  - Added modal translations in all 3 locales (RO/EN/HU)
- Files changed:
  - src/components/features/CookieConsent/index.tsx (updated - added modal state, handlers, and modal UI)
  - src/components/features/CookieConsent/CookieConsentWrapper.tsx (updated - added modal translations)
  - src/messages/ro.json (updated - added modal translations)
  - src/messages/en.json (updated - added modal translations)
  - src/messages/hu.json (updated - added modal translations)
  - PRD.md (updated)
- Learnings for future iterations:
  - Toggle switches use role="switch" with aria-checked for accessibility
  - Essential cookies shown as locked with Lock icon and "Always active" label
  - Modal z-index (z-[60]) must be higher than banner z-index (z-50)
  - Event handlers for keyboard (Escape) and backdrop click improve UX
  - Sticky header/footer in modal keeps controls visible during scroll
---

## Iteration 35 - US-035: Create WhatsApp floating button
- What was implemented:
  - Created `src/components/features/WhatsAppButton/index.tsx` client component
  - Fixed position bottom-right corner (bottom-4 right-4 mobile, bottom-6 right-6 desktop)
  - WhatsApp green color (#25D366) with matching shadow
  - Subtle pulse animation on load (stops after 5 seconds)
  - Click opens WhatsApp with pre-filled message using wa.me API
  - Responsive sizing: h-14 w-14 on mobile, h-16 w-16 on desktop
  - Created `src/components/features/WhatsAppButton/WhatsAppButtonWrapper.tsx` for i18n integration
  - Added custom pulse-whatsapp animation to globals.css
  - Integrated into layout.tsx after Footer, before CookieConsent
  - Button appears after 1 second delay to prevent flash
- Files changed:
  - src/components/features/WhatsAppButton/index.tsx (new)
  - src/components/features/WhatsAppButton/WhatsAppButtonWrapper.tsx (new)
  - src/styles/globals.css (updated - added pulse-whatsapp animation)
  - src/app/[locale]/layout.tsx (updated - added WhatsAppButtonWrapper)
  - PRD.md (updated)
- Learnings for future iterations:
  - WhatsApp URL format: wa.me/{phone}?text={encodedMessage} where phone uses country code (40 for Romania)
  - Client-side delay pattern (isMounted + setTimeout) prevents hydration issues and flash
  - Pulse animation can be stopped after initial period by toggling isPulsing state
  - z-40 places button below cookie consent (z-50) to not interfere with GDPR UI
  - Theme already had --color-whatsapp and --shadow-whatsapp defined for consistency
---

## Iteration 36 - US-036: Create video testimonial player component
- What was implemented:
  - Created `src/components/features/VideoTestimonial/VideoPlayer.tsx` client component
  - Custom play button overlay on thumbnail with hover scale effect
  - Supports YouTube, Vimeo embeds, and direct video files via URL parsing
  - Auto-detects video source type from URL patterns
  - YouTube videos: extracts video ID, auto-generates thumbnail from img.youtube.com
  - Vimeo videos: extracts video ID, embeds with Vimeo player
  - Direct videos: HTML5 video element with custom controls
  - Muted by default with toggle unmute button
  - Responsive 16:9 aspect ratio using aspect-video class
  - Custom controls for direct video: play/pause center button, bottom control bar with mute toggle
  - Controls auto-hide after 3 seconds when playing
  - Keyboard shortcuts: Space/K to play/pause, M to mute/unmute, Escape to close
  - Close button option via showCloseButton prop
  - Title overlay on thumbnail and during playback
  - Created index.ts for component exports
- Files changed:
  - src/components/features/VideoTestimonial/VideoPlayer.tsx (new)
  - src/components/features/VideoTestimonial/index.ts (new)
  - PRD.md (updated)
- Learnings for future iterations:
  - exactOptionalPropertyTypes requires checking `match && match[1]` before using captured group
  - YouTube thumbnail URL pattern: img.youtube.com/vi/{videoId}/maxresdefault.jpg
  - Vimeo thumbnails require API call (not included - uses posterUrl prop instead)
  - YouTube embed params: autoplay=1&mute={0|1}&rel=0 for autoplay with mute control
  - useRef with NodeJS.Timeout for cleanup timeout tracking
  - Phase 3 (Interactive Features) is now COMPLETE - all 11 stories finished
---
