# Progress Log

## Current Status
- **Phase 1:** CMS Foundation (US-001 to US-012) - COMPLETE (12/12 complete)
- **Phase 2:** Inner Pages (US-013 to US-025) - NOT STARTED
- **Phase 3:** Interactive Features (US-026 to US-036) - NOT STARTED
- **Phase 4:** Polish & SEO (US-037 to US-042) - NOT STARTED

## Completed Stories
- US-001: Initialize Sanity Studio project
- US-002: Create localizedString and localizedText object schemas
- US-003: Create SEO and portableText object schemas
- US-004: Create Service document schema
- US-005: Create TeamMember document schema
- US-006: Create Testimonial document schema
- US-007: Create BeforeAfter document schema
- US-008: Create BlogPost and BlogCategory schemas
- US-009: Create FAQ and Price document schemas
- US-010: Create Settings singleton and LegalPage schemas
- US-011: Create GROQ queries for all content types
- US-012: Create Sanity image URL helper

## In Progress
(None)

## Learnings
(Patterns discovered during implementation)
- Use bracket notation for process.env access: `process.env['VARIABLE']` instead of `process.env.VARIABLE` to satisfy exactOptionalPropertyTypes
- next-sanity@11 is compatible with Next.js 15, sanity@4, and @sanity/client@7
- Sanity Studio route needs its own layout.tsx to avoid locale routing conflicts
- Use `as const` for href arrays to satisfy next-intl typed routes

---

## Session Notes

### 2026-01-15
- PRD created with 42 user stories
- Stories organized in 4 phases by dependency
- Each story sized for single context window (~10 min AI work)
- Foundation already complete: Next.js 15, Tailwind v4, next-intl, Header/Footer/Homepage with placeholder

---

## Iteration 1 - US-001: Initialize Sanity Studio project
- What was implemented:
  - Installed Sanity dependencies (next-sanity@11, sanity@4, @sanity/client@7, @sanity/image-url, styled-components@6)
  - Created sanity.config.ts at project root
  - Created src/lib/sanity/client.ts with createClient setup and preview client
  - Created sanity/schemas/index.ts (empty, ready for future schemas)
  - Created Sanity Studio route at /studio with dedicated layout
  - Updated .env.example with SANITY_* environment variables
- Files changed:
  - package.json (added dependencies)
  - sanity.config.ts (new)
  - sanity/schemas/index.ts (new)
  - src/lib/sanity/client.ts (new)
  - src/app/studio/[[...tool]]/page.tsx (new)
  - src/app/studio/[[...tool]]/layout.tsx (new)
  - .env.example (updated)
- Pre-existing type errors fixed:
  - src/app/[locale]/layout.tsx - fixed metadata title/description typing
  - src/components/layout/Footer.tsx - fixed Link href typing with `as const`
- Learnings for future iterations:
  - next-sanity@12+ requires Next.js 16, use @11 for Next.js 15
  - TypeScript exactOptionalPropertyTypes requires explicit string defaults
  - Studio route bypasses locale routing via separate app directory structure
---

## Iteration 2 - US-002: Create localizedString and localizedText object schemas
- What was implemented:
  - Created `sanity/schemas/objects/localizedString.ts` with ro, en, hu string fields
  - Created `sanity/schemas/objects/localizedText.ts` with ro, en, hu text fields
  - Updated `sanity/schemas/index.ts` to export both schema types
- Files changed:
  - sanity/schemas/objects/localizedString.ts (new)
  - sanity/schemas/objects/localizedText.ts (new)
  - sanity/schemas/index.ts (updated)
- Learnings for future iterations:
  - Sanity uses defineType and defineField from 'sanity' package for schema definitions
  - Object schemas go in sanity/schemas/objects/ directory
  - All schemas must be exported from schemaTypes array in index.ts
---

## Iteration 3 - US-003: Create SEO and portableText object schemas
- What was implemented:
  - Created `sanity/schemas/objects/seo.ts` with metaTitle, metaDescription, ogImage, noIndex fields
  - Created `sanity/schemas/objects/portableText.ts` with blocks (h2-h4, blockquote), lists, marks (strong/em/underline), link annotations, images with alt/caption, and video embed support
  - Created `sanity/schemas/objects/localizedPortableText.ts` wrapping portableText for RO/EN/HU
  - Updated `sanity/schemas/index.ts` to export all new schemas
- Files changed:
  - sanity/schemas/objects/seo.ts (new)
  - sanity/schemas/objects/portableText.ts (new)
  - sanity/schemas/objects/localizedPortableText.ts (new)
  - sanity/schemas/index.ts (updated)
- Learnings for future iterations:
  - Use defineArrayMember for array items in Sanity schemas
  - portableText is defined as type 'array' not 'object', containing block and other content types
  - Video embed uses inline object type with name for custom block types
---

## Iteration 4 - US-004: Create Service document schema
- What was implemented:
  - Created `sanity/schemas/documents/service.ts` with all required fields: title (localizedString), slug, icon, shortDescription, description (localizedPortableText), benefits (array of objects), process (array of steps), heroImage, priceRange, seo, order
  - Added validation for required fields (title, slug)
  - Exported service schema from `sanity/schemas/index.ts`
  - Organized index.ts with comments separating Objects and Documents
- Files changed:
  - sanity/schemas/documents/service.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Document schemas go in sanity/schemas/documents/ directory (separate from objects/)
  - Use `defineArrayMember` for inline object types in arrays
  - Preview prepare function allows custom formatting in Sanity Studio list views
  - Orderings allow custom sort options in Studio document lists
---

## Iteration 5 - US-005: Create TeamMember document schema
- What was implemented:
  - Created `sanity/schemas/documents/teamMember.ts` with all required fields
  - Fields: name (string), slug, role (localizedString), specializations (array of objects), photo (image with hotspot), bio (localizedPortableText), education (array with institution/degree/year), certifications (array with name/issuer/year), services (references to service), order, seo
  - Added validation for required fields (name, slug)
  - Exported teamMember schema from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/teamMember.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Reference fields use `defineArrayMember({ type: 'reference', to: [{ type: 'docType' }] })`
  - Array of objects with preview prepare allows custom formatting with multiple select fields
  - Name field uses plain string type (not localizedString) for proper person names
---

## Iteration 6 - US-006: Create Testimonial document schema
- What was implemented:
  - Created `sanity/schemas/documents/testimonial.ts` with all required fields
  - Fields: patientName (string), patientPhoto (image with hotspot), rating (number 1-5), text (localizedText), videoUrl (url), videoFile (file), service (reference), doctor (reference), featured (boolean), date
  - Added validation: rating min 1 max 5 with integer constraint
  - Exported testimonial schema from `sanity/schemas/index.ts`
  - Custom preview with star rating display (★☆) and service name
- Files changed:
  - sanity/schemas/documents/testimonial.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Single reference fields use `type: 'reference', to: [{ type: 'docType' }]` without array wrapper
  - File fields support accept option for MIME type filtering (e.g., 'video/*')
  - Unicode characters (★☆) work in preview prepare for visual star ratings
---

## Iteration 7 - US-007: Create BeforeAfter document schema
- What was implemented:
  - Created `sanity/schemas/documents/beforeAfter.ts` with all required fields
  - Fields: title (localizedString), service (reference), doctor (reference), beforeImage (required image with hotspot), afterImage (required image with hotspot), description (localizedText), treatmentDuration (string), featured (boolean)
  - Added validation: both beforeImage and afterImage are required
  - Custom preview showing title, service name, featured status, and after image
  - Custom orderings: Featured First, Newest First
  - Exported beforeAfter schema from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/beforeAfter.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - BeforeAfter cases use localizedText for description (not localizedPortableText) since rich text isn't needed for brief case descriptions
  - Image fields with required validation use `validation: (rule) => rule.required()`
  - Preview uses afterImage as media to show the successful result
---

## Iteration 8 - US-008: Create BlogPost and BlogCategory schemas
- What was implemented:
  - Created `sanity/schemas/documents/blogCategory.ts` with title (localizedString) and slug fields
  - Created `sanity/schemas/documents/blogPost.ts` with all required fields: title, slug, excerpt, content (localizedPortableText), coverImage, category (reference to blogCategory), author (reference to teamMember), publishedAt, featured, seo
  - Added validation for required fields (title, slug) on both schemas
  - Custom preview for blogPost showing title, category, author, and published date
  - Custom orderings for blogPost: newest first, oldest first, title
  - Exported both schemas from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/blogCategory.ts (new)
  - sanity/schemas/documents/blogPost.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - BlogCategory is a simple schema - just title and slug, no complex fields needed
  - BlogPost references both blogCategory and teamMember for category and author
  - Preview prepare can format dates using toLocaleDateString for locale-specific display
  - Draft posts without publishedAt can show 'Draft' as fallback in preview
---

## Iteration 9 - US-009: Create FAQ and Price document schemas
- What was implemented:
  - Created `sanity/schemas/documents/faq.ts` with all required fields
  - Fields: question (localizedString), answer (localizedPortableText), category (select with radio layout), services (references array), order
  - Created `sanity/schemas/documents/price.ts` with all required fields
  - Fields: service (reference), name (localizedString), description (localizedText), priceMin, priceMax, unit, isPromotion, promotionPrice (conditionally hidden), includesInCalculator
  - Added validation for required fields
  - Exported both schemas from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/faq.ts (new)
  - sanity/schemas/documents/price.ts (new)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Use `options.layout: 'radio'` for select fields with few options
  - `hidden: ({ parent }) => !parent?.field` allows conditional field visibility in Sanity
  - Price documents reference services to enable grouping prices by service category
  - Category-based FAQs use string select with defined list for filtering/grouping
---

## Iteration 10 - US-010: Create Settings singleton and LegalPage schemas
- What was implemented:
  - Created `sanity/schemas/documents/settings.ts` singleton schema with:
    - siteName (localizedString), logo (image), contact object (phone, email, whatsapp, address)
    - workingHours (array with days, hours, closed fields)
    - socialLinks (object with facebook, instagram, youtube, linkedin, tiktok URLs)
    - googleMapsEmbed (url)
  - Created `sanity/schemas/documents/legalPage.ts` schema with:
    - title (localizedString), slug, content (localizedPortableText), lastUpdated (date)
  - Created `sanity/deskStructure.ts` for custom Sanity Studio desk structure
    - Settings displayed as singleton (single document with fixed ID 'siteSettings')
    - Organized content into logical groups with icons
    - Blog section nested with Posts and Categories
  - Updated `sanity.config.ts` to use custom desk structure
  - Exported both schemas from `sanity/schemas/index.ts`
- Files changed:
  - sanity/schemas/documents/settings.ts (new)
  - sanity/schemas/documents/legalPage.ts (new)
  - sanity/deskStructure.ts (new)
  - sanity.config.ts (updated)
  - sanity/schemas/index.ts (updated)
  - PRD.md (updated)
- Learnings for future iterations:
  - Singleton documents use fixed documentId in desk structure: `S.document().schemaType('settings').documentId('siteSettings')`
  - structureTool() accepts structure option for custom desk organization
  - Lucide icons need type casting: `const icon = (Icon: ComponentType) => Icon as ComponentType`
  - URL fields use `type: 'url'` for proper validation
  - Date fields can specify format with `options.dateFormat`
---

## Iteration 11 - US-011: Create GROQ queries for all content types
- What was implemented:
  - Created `src/lib/sanity/queries.ts` with comprehensive GROQ queries for all content types
  - Query functions: getAllServices, getServiceBySlug, getServiceSlugs, getAllTeamMembers, getTeamMemberBySlug, getTeamMemberSlugs, getAllTestimonials, getFeaturedTestimonials, getAllBeforeAfter, getFeaturedBeforeAfter, getBlogPosts, getBlogPostBySlug, getBlogPostSlugs, getBlogCategories, getBlogPostsCount, getFAQs, getFAQsByCategory, getPrices, getPricesGroupedByService, getSettings, getLegalPageBySlug, getLegalPageSlugs
  - All queries accept locale parameter (ro/en/hu) for localized content projection
  - Helper functions for consistent localized field projections
  - Queries include proper dereferencing with `->` for referenced documents
  - Support for pagination (getBlogPosts with limit/offset) and filtering (category, featured, etc.)
- Files changed:
  - src/lib/sanity/queries.ts (new)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - Use helper functions for repeated localized field projections to keep queries DRY
  - GROQ uses `->` for dereferencing references inline
  - Portable text arrays need `[]` suffix in projection: `fieldName.${locale}[]`
  - String interpolation with template literals works well for dynamic GROQ query building
  - Sanity client.fetch accepts params object as second argument for query variables
---

## Iteration 12 - US-012: Create Sanity image URL helper
- What was implemented:
  - Created `src/lib/sanity/image.ts` with comprehensive image URL utilities
  - Main helper `urlFor(source)` returns ImageUrlBuilder for chaining transformations (width, height, quality, auto format, blur, etc.)
  - Added `generateSrcSet()` helper for responsive image srcset generation
  - Added `getBlurDataURL()` helper for blur placeholders
  - Package @sanity/image-url was already installed in US-001
- Files changed:
  - src/lib/sanity/image.ts (new)
  - PRD.md (updated)
  - progress.txt (updated)
- Learnings for future iterations:
  - @sanity/image-url v2 exports SanityImageSource type directly from main module
  - ImageUrlBuilder supports chaining: urlFor(image).width(800).quality(80).auto('format').url()
  - Phase 1 (CMS Foundation) is now complete - all schemas and helpers are ready
---
